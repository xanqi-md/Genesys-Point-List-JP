<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genesys Regulation Point Search</title>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-main: #e0e0e0;
            --text-sub: #a0a0a0;
            --accent: #ff5252;
            --pt-100: #ff4757;
            --pt-high: #ffa502;
            --pt-mid: #2ed573;
            --pt-low: #1e90ff;
        }

        body {
            font-family: "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            margin: 0;
            font-size: 1.8rem;
            color: var(--text-main);
        }

        .controls {
            position: sticky;
            top: 0;
            background-color: var(--bg-color);
            padding: 15px 0;
            z-index: 100;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            border-bottom: 1px solid #333;
        }

        input[type="text"] {
            padding: 12px;
            width: 100%;
            max-width: 400px;
            border-radius: 8px;
            border: 1px solid #444;
            background-color: #2c2c2c;
            color: white;
            font-size: 16px;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--pt-low);
        }

        .stats {
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-sub);
            margin-bottom: 10px;
        }

        /* Grid Layout */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 15px;
            padding-top: 20px;
        }

        .card-item {
            background-color: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.2s;
            display: flex;
            flex-direction: column;
            position: relative;
            border: 1px solid #333;
        }

        .card-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }

        .card-img-container {
            width: 100%;
            aspect-ratio: 323 / 471; /* YGO Card Ratio */
            background-color: #000;
            position: relative;
        }

        .card-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .card-img.loaded {
            opacity: 1;
        }

        .point-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 1.1rem;
            color: #fff;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            z-index: 2;
        }

        .card-info {
            padding: 10px;
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .card-name {
            font-size: 0.9rem;
            font-weight: bold;
            line-height: 1.4;
            word-break: break-word;
        }

        .loading-msg {
            text-align: center;
            color: var(--pt-mid);
            margin-top: 20px;
            display: none;
        }

        /* Utilities */
        .pt-100 { background-color: var(--pt-100); }
        .pt-high { background-color: var(--pt-high); } /* 50-99 */
        .pt-mid { background-color: var(--pt-mid); }   /* 20-49 */
        .pt-low { background-color: var(--pt-low); }   /* 0-19 */

        @media (max-width: 600px) {
            .card-grid {
                grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            }
            h1 { font-size: 1.4rem; }
        }
    </style>
</head>
<body>

<header>
    <h1>Genesys Regulation Points</h1>
    <div class="stats" id="status">Loading data...</div>
</header>

<div class="controls">
    <input type="text" id="searchInput" placeholder="カード名またはポイントで検索 (例: 増殖, 100)">
</div>

<div id="grid" class="card-grid">
    <!-- Cards will be injected here -->
</div>

<script>
// --- 1. CSV DATA EMBEDDED ---
const csvRaw = `
ポイント,カード名
100,地獄人形の館
100,ジャンク・スピーダー
100,ナチュル・エクストリオ
100,No.16 色の支配者ショック・ルーラー
100,No.41 泥睡魔獣バグースカ
100,No.43 魂魄傀儡鬼ソウル・マリオネッター
100,No.59 背反の料理人
100,SNo.0 ホープ・ゼアル
100,盃満ちる燦幻荘
100,暗黒界の軍神 シルバ
100,原罪宝－スネークアイ
100,逢華妖麗譚－魔妖不知火語
100,深淵に潜む者
100,虚竜魔王アモルファクターP
100,召喚制限－ディスコードセクター
100,エンジェルO７
100,魔封じの芳香
100,アルカナフォースⅩⅩⅠ－THE WORLD
100,大天使クリスティア
100,アークネメシス・エスカトス
100,アークネメシス・プロートス
100,アーティファクト－デスサイズ
100,永遠の淑女 ベアトリーチェ
100,脳開発研究所
100,カタパルト・タートル
100,大寒波
100,押収
100,接触するG
100,デッキロック
100,いたずら好きな双子悪魔
100,次元障壁
100,儀式魔人リリーサー
100,究極竜魔導師
100,竜の束縛
100,終焉のカウントダウン
100,フォッシル・ダイナ パキケファロ
100,六武の門
100,御前試合
100,ハーピィの羽根吹雪
100,大熱波
100,超魔神イド
100,王宮の勅命
100,簡易融合
100,昇霊術師 ジョウゲン
100,カイザーコロシアム
100,夢幻崩界イヴリース
100,遺言状
100,レベル・スティーラー
100,ライフチェンジャー
100,一回休み
100,マジシャン・オブ・ブラックカオス・MAX
100,威光魔人
100,マスドライバー
100,メンタルドレイン
100,手違い
100,氷霊神ムーラングレイス
100,魔鍾洞
100,外神アザトート
100,能力吸収石
100,禁止令
100,PSYフレームロード・Ω
100,超魔導竜騎士－ドラグーン・オブ・レッドアイズ
100,群雄割拠
100,王立魔法図書館
100,王宮の弾圧
100,発禁令
100,魔法族の里
100,自爆スイッチ
100,スキルドレイン
100,ソウルドレイン
100,サモンリミッター
100,念動増幅装置
100,星守りの騎士 プトレマイオス
100,強引な番兵
100,異星の最終戦士
100,The tyrant NEPTUNE
100,センサー万別
100,真竜皇V.F.D.
100,暴君の暴言
100,アルティマヤ・ツィオルキン
100,虚無空間
100,虚無魔人
100,虚無の統括者
100,召喚獣カリギュラ
100,ラストバトル！
100,ヴェルズ・ウロボロス
100,天羽々斬之巳剣
100,魔王龍 ベエルゼ
100,イビリチュア・ガストクラーケ
100,大逆転クイズ
97,クシャトリラ・アライズハート
95,魔導サイエンティスト
95,苦渋の選択
94,ダスト・シュート
93,三戦の才
91,ダイノルフィア・レクスターム
91,旧神ノーデン
91,ギブ＆テイク
91,ワン・フォー・ワン
88,インフェルニティガン
87,盗人の煙玉
85,No.1 インフェクション・バアル・ゼブル
85,No.89 電脳獣ディアブロシス
85,妖精伝姫－シラユキ
81,バハムート・シャーク
80,No.97 龍影神ドラッグラビオン
80,赤き竜
80,フルール・ド・バロネス
80,ラヴァルバル・チェイン
80,轟雷帝ザボルグ
80,No.99 希望皇ホープドラグナー
77,DDD双暁王カリユガ
76,ファントム・オブ・ユベル
75,コアキメイル・ドラゴ
75,マジカル・エクスプロージョン
75,幻創のミセラサウルス
75,ゼンマイハンター
70,No.75 惑乱のゴシップ・シャドー
70,ナンバーズ・エヴァイユ
70,重爆撃禽 ボム・フェネクス
70,ギミック・パペット－ナイトメア
70,M・HERO ダーク・ロウ
70,深淵の結界像
70,干ばつの結界像
70,閃光の結界像
70,業火の結界像
70,烈風の結界像
70,豪雨の結界像
67,超雷竜ーサンダー・ドラゴン
67,No.67 パラダイスマッシャー
66,失烙印
66,ジェムナイトマスター・ダイヤ
66,十二獣ブルホーン
65,第六感
61,サイキック・ブロッカー
60,エルシャドール・ミドラーシュ
60,半魔導帯域
60,粋カエル
60,イレカエル
55,D・テレホン
51,巳剣勧請
51,巳剣降臨
51,魔獣の大餌
51,ブラック・ガーデン
51,D.D.ダイナマイト
51,地縛神 Aslla piscu
51,ジェムナイトレディ・ラピスラズリ
50,古衛兵アギド
50,古尖兵ケルベク
50,No.40 ギミック・パペット－ヘブンズ・ストリングス
50,CNo.40 ギミック・パペット－デビルズ・ストリングス
50,No.95 ギャラクシーアイズ・ダークマター・ドラゴン
50,ティアラメンツ・ハゥフニス
50,ティアラメンツ・キトカロス
50,ティアラメンツ・メイルゥ
50,ティアラメンツ・レイノハート
50,ティアラメンツ・シェイレーン
50,ナチュル・ビースト
50,天盃龍チュンドラ
50,紅蓮の指名者
50,連鎖爆撃
50,混沌魔龍 カオス・ルーラー
50,真帝王領域
50,虹光の宣告者
50,増殖するG
50,モンスターゲート
50,巡死神リーパー
50,壱世壊＝ペルレイノ
50,名推理
50,レッド・リブート
50,異次元からの帰還
50,燦幻開門
50,ソウル・チャージ
50,隣の芝刈り
50,帝王の溶撃
50,真血公ヴァンパイア
50,十二獣モルモラット
45,次元融合
40,海皇の竜騎隊
40,手札抹殺
40,命削りの宝札
40,混沌領域
40,サイバー・エンジェル－弁天－
40,ハリケーン
40,天使の施し
40,王家の眠る谷－ネクロバレー
40,魔獣の懐柔
40,金満で謙虚な壺
40,烙印融合
35,炎舞－「天璣」
35,化石調査
35,増援
33,生還の宝札
33,緊急テレポート
33,百鬼羅刹大参上
33,ヌメロン・ネットワーク
33,深淵の獣マグナムート
33,ホルスの栄光－イムセティ
33,王の棺
33,ビッグウェルカム・ラビュリンス
33,白銀の城のラビュリンス
33,ウェルカム・ラビュリンス
33,再世記
33,暗黒界の術師 スノウ
33,海皇子 ネプトアビス
33,真炎竜アルビオン
33,分かつ烙印
33,氷剣竜ミラジェイド
33,相剣大師ー赤霄
33,告死聖徒ルシエラーゴ
33,罪宝の欺き
33,"罪宝狩りの悪魔"
33,白き森の魔女
33,古代の進軍
33,古代の機械像
33,粛声なる結界
33,ブロックドラゴン
33,篝火
33,ブリリアント・フュージョン
33,騎士皇アークシーラ
33,光の援軍
33,コーンフィールド コアトル
33,クリストロン・インクルージョン
33,サイバーポッド
33,深海のアリア
33,源竜星－ボウテンコウ
33,宣告者の神巫
33,ドラゴニックD
33,竜輝巧－バンα
33,竜輝巧－ファフμβ’
33,エクリプス・ワイバーン
33,EMERGENCY!
33,フィッシュボーグ－ガンナー
33,ふわんだりぃず×ろびーな
33,ふわんだりぃずと旅じたく
33,ふわんだりぃずと謎の地図
33,おろかな埋葬
33,魔玩具補綴
33,フュージョン・デステニー
33,御影志士
33,ガーディアン・キマイラ
33,迫りくる機械
33,ヘルフレイムバンシー
33,妨げられた壊獣の眠り
33,キングレムリン
33,ローンファイア・ブロッサム
33,M.X－セイバー インヴォーカー
33,真竜剣皇マスターP
33,冥骸王－メメントラン・テクトリカ
33,メメント・ボーン・パーティー
33,メメント・ツイン・ドラゴン
33,メタモルポット
33,天底の使徒
33,オオヒメの御巫
33,オノマト連携
33,六世壊＝パライゾス
33,原石の皇脈
33,クイック・リボルブ
33,無限竜シュヴァルツシルト
33,千年の眠りから覚めし原人
33,盆回し
33,紫炎の狼煙
33,シューティング・ライザー・ドラゴン
33,輝光竜セイファート
33,鬼ガエル
33,TG ハイパー・ライブラリアン
33,テラ・フォーミング
33,ドラゴン・目覚めの旋律
33,発条空母ゼンマイティ
33,青き眼の祈り
33,十二獣の会局
33,剣闘獣総監エーディトル
33,VS ホーリー・スー
33,メガリス・アナスタシス
31,No.86 H－C ロンゴミアント
30,クシャトリラ・フェンリル
30,クシャトリラ・ユニコーン
30,ヌメロン・ダイレクト
30,深淵の獣バルドレイク
30,深淵の獣ドルイドヴルム
30,深淵の獣ルベリオン
30,ファイバーポッド
30,強欲な壺
27,デビル・フランケン
25,ナイトメア・スローン
25,龍相剣現
25,剣闘訓練所
25,ユニオン格納庫
25,霊王の波動
25,幻禄の天盃龍
25,白き森の妖魔ディアベル
25,エクス・ライゼオル
22,白き森の聖徒リゼット
21,グローアップ・バルブ
21,No.100 ヌメロン・ドラゴン
21,コズミック・ブレイザー・ドラゴン
21,聖珖神竜 スターダスト・シフル
20,ライトニング・ストーム
20,幻惑の見習い魔術師
20,No.38 希望魁竜タイタニック・ギャラクシー
20,ギガンティック・スプライト
20,ドラゴンメイド・シュトラール
20,ドラゴンメイド・ラティス
20,深淵の獣サロニール
20,FNo.0 未来龍皇ホープ
20,流離のグリフォンライダー
20,背信聖徒シルヴィア
20,黒魔女ディアベルスター
20,魔救の奇跡－ドラガイト
20,BF－魔風のボレアース
20,墓穴の指名者
20,カオス・アンヘル－混沌の双翼－
20,サイバー・ドラゴン・インフィニティ
20,DDD怒涛大王エグゼクティブ・シーザー
20,電光－雪花－
20,D-HERO デストロイフェニックスガイ
20,D-HERO Bloo-D
20,天霆號アーゼウス
20,星辰爪竜アルザリオン
20,星辰砲手ファイメナ
20,F.A.ライトニングマスター
20,炎王妃 ウルカニクス
20,アイズ・ライゼオル
20,インスペクト・ボーダー
20,K９－１７号 イヅナ
20,光と闇の竜王
20,LL－バード・コール
20,戎の忍者－冥禪
20,強欲で貪欲な壺
20,サイコ・エンド・パニッシャー
20,ライゼオル・デッドネーダー
20,ライゼオル・デュオドライブ
20,マジック・キャンセラー
20,ソード・ライゼオル
20,幻の召喚神エクゾディア
20,ライオウ
20,餅カエル
20,終戒超獣ーヴァルドラス
20,電脳堺狐ー仙々
20,十二獣ドランシア
20,烙印竜アルビオン
20,エヴォルカイザー・ラーズ
20,琰魔竜 レッド・デーモン・アビス
16,赫灼竜マスカレイド
15,ハーピィの羽根帚
15,K９－１７号 “Ripper”
15,灰流うらら
15,PSYフレームギア・γ
15,ピュアリィ
15,ピュアリィ・スリーピィメモリー
15,K９－６６a号 ヨクル
15,K９－０４号 咒
15,The Fallen ＆ The Virtuous
13,天威龍ーアシュナ
13,地中界シャンバラ
13,BF－精鋭のゼピュロス
13,幻竜星－チョウホウ
13,無限泡影
13,三戦の号
13,超融合
13,氷結界の龍 トリシューラ
13,幻子力空母エンタープラズニル
11,一時休戦
11,クイズ
11,VS 蛟龍
11,VS ラゼン
10,神炎竜ルベリオン
10,スプライト・スターター
10,大嵐
10,剣闘排斥波
10,死者蘇生
10,No.90 銀河眼の光子卿
10,エルシャドール・アプカローネ
10,ドラゴンメイドのお片付け
10,ナチュル・パルキオン
10,No.60 刻不知のデュガレス
10,No.1 ゲート・オブ・ヌメロン－エーカム
10,No.2 ゲート・オブ・ヌメロン－ドゥヴェー
10,No.3 ゲート・オブ・ヌメロン－トゥリーニ
10,No.4 ゲート・オブ・ヌメロン－チャトゥヴァーリ
10,CNo.1 ゲート・オブ・カオス・ヌメロン－シニューニャ
10,深淵の神獣ディス・パテル
10,マルチャミー・プルリア
10,六武衆の荒行
10,心変わり
10,混源龍レヴィオニア
10,抹殺の指名者
10,異次元グランド
10,ディメンション･アトラクター
10,ダイナレスラー・パンクラトプス
10,聖王の粉砕
10,表裏一体
10,拮抗勝負
10,炎王神獣 キリン
10,禁じられた一滴
10,封印の黄金櫃
10,計都星辰
10,真炎王 ポニクス
10,真魔六武衆－シエン
10,真六武衆－シエン
10,光道の龍
10,御巫の水舞踏
10,儀式の下準備
10,ピュアリィ・リリィ
10,R－ACEプリベンター
10,霊獣使いの長老
10,王宮のお触れ
10,影依の偽典
10,紫炎の道場
10,列王詩篇
10,精霊獣使い レラ
10,厄災の星ティ・フォン
10,嗤う黒山羊
10,フレシアの蠱惑魔
10,痕喰竜ブリガンド
10,エクソシスター・ミカエリス
10,エクソシスター・パークス
10,赫焉竜グランギニョル
10,グリザイユの牢獄
10,K9－EX “Werewolf”
10,N・As・H Knight
10,強欲で金満な壺
10,鉄駆竜スプリンド
10,灰燼竜バスタード
10,聖痕喰らいし竜
7,早すぎた埋葬
7,マルチャミー・フワロス
7,焔征竜－ブラスター
7,巌征竜－レドックス
7,嵐征竜ーテンペスト
7,瀑征竜ータイダル
7,月の書
7,チキンレース
7,未界域のネッシー
7,未界域のジャッカロープ
7,未界域のツチノコ
7,竜の影光
7,エフェクト・ヴェーラー
7,旧神ヌトス
7,左腕の代償
7,斬機シグマ
7,PSYフレームギア・δ
7,PSYフレームギア・ε
7,サンダー・ボルト
7,復活の福音
7,強奪
7,神の宣告
7,トランザクション・ロールバック
7,トラップホリック
7,SRベイゴマックス
7,ドドドドウォリアー
7,竜の精神
7,飛翔するG
7,百鬼羅刹大収監
5,突然変異
5,冑の忍者ー櫓丸
5,命王の螺旋
5,原始生命態ニビル
5,R－ACEエアホイスター
5,アサルト・シンクロン
5,アラメシアの儀
5,聖殿の水遣い
5,屋敷わらし
5,暗黒界の文殿
5,暗黒界の取引
5,暗黒界の龍神 グラファ
5,暗黒界の龍神王 グラファ
5,暗黒界の門
5,相剣軍師ー龍淵
5,スネークアイ・エクセル
5,蛇眼の炎燐
5,闇の誘惑
5,皆既日蝕の書
5,重騎士 プリメラ
5,水晶機巧－スモーガー
5,水晶機巧－シストバーン
5,闇と消滅の竜
5,魔砲戦機ダルマ・カルマ
5,星辰竜ムルル
5,ドロール＆ロックバード
5,禁じられた聖杯
5,心宿りし青眼竜
5,K９－ØØ号 ルプス
5,光と昇華の竜
5,LL－ベリル・カナリー
5,儀式の準備
5,RUM－アージェント・カオス・フォース
5,RUM－ スキップ・フォース
5,RUM－ ソウル・シェーヴ・フォース
5,神の通告
5,神の警告
5,スタンドアップ・センチュリオン！
5,光天使セプター
5,光天使スローネ
5,ストレイ・ピュアリィ・ストリート
5,サブテラーの導師
5,斎キ狭依姫
5,鉄騎の雷鎚
5,創獄神ネルヴァ
5,No－P.U.N.K.フォクシー・チューン
5,No.3 地獄蝉王ローカスト・キング
5,R－ACEインパルス
5,応戦するG
5,神の忠告
5,王の遺宝祀りし聖域
5,鉄獣鳥 メルクーリエ
3,朔夜しぐれ
3,幽鬼うさぎ
3,古聖戴サウラヴィス
3,マルチャミー・ニャルス
3,儚無みずき
3,赫の聖女カルテシア
3,導きの聖女クエム
3,相剣師ー莫邪
3,白の聖女エクレシア
3,アストラル・クリボー
3,従騎士トゥルーデア
3,水晶機巧－サルファドール
3,未界域のビッグフット
3,未界域のチュパカブラ
3,未界域のワーウルフ
3,未界域のモスマン
3,未界域のオゴポコ
3,未界域のサンダーバード
3,ブラック・ホール
3,教導の聖女エクレシア
3,E・HERO エアーマン
3,おろかな副葬
3,禁じられた聖槍
3,無の煉獄
3,鎧騎士竜－ナイト・アームド・ドラゴン－
3,コアキメイル・ガーディアン
3,コアキメイル・オーバードーズ
3,コアキメイル・サンドマン
3,コアキメイル・ウォール
3,メタバース
3,千年の十字
3,多元宇宙
3,おジャマトリオ
3,擬似空間
3,魔界発現世行きデスガイド
3,電脳堺媛ー瑞々
3,暗黒界の狩人 ブラウ
3,トーテムバード
3,トラップトリック
3,成金ゴブリン
2,おジャマデュオ
2,惑星探査車
1,宿神像ケルドウ
1,剣神官ムドラ
1,ジェット・シンクロン
1,蝶の短剣－エルマ
1,強制転移
1,ダイガスタ・エメラル
1,終焉の地
1,ダイノルフィア・インタクト
1,イーバ
1,琰魔竜王 レッド・デーモン・カラミティ
1,HRUM－ユートピア・フォース
1,光の結界
1,LL－インディペンデント・ナイチンゲール
1,メンタルマスター
1,RUM－ファントム・フォース
1,ラーの使徒
1,RUM－七皇の剣
1,RUM－千死蛮巧
1,RUM－アストラル・フォース
1,RUM－バリアンズ・フォース
1,RUM－光波昇華
1,RUM－デス・ダブル・フォース
1,RUM－リミテッド・バリアンズ・フォース
1,RUM－マジカル・フォース
1,RUM－デス・ダブル・フォース
1,RUM－クイック・カオス
1,RUM－ レイドフォース
1,RUM－ラプターズ・フォース
1,RUM－レヴォリューション・フォース
1,RUM－ゼアル・フォース
1,ЯRUM－レイド・ラプターズ・フォース
1,覇王眷竜スターヴ・ヴァノム
1,RUMーファントム・ナイツラウンチ
1,ブラックフェザー・アサルト・ドラゴン
1,黒薔薇の破滅竜
1,ダイノルフィア・ドメイン
1,ダイノルフィア・フレンジー
1,イビリチュア・マインドオーガス
1,リチュアの氷魔鏡
1,リチュアの儀水鏡
1,影の王 レイヴァーテイン
1,マンジュ・ゴッド
1,No.69 紋章神コート・オブ・アームズ
1,QQエニアゴン
1,真紅眼の鋼炎竜
1,センジュ・ゴッド
1,星遺物の胎導
`;

// --- 2. LOGIC ---
let processedData = [];
let cardMap = new Map();

const statusEl = document.getElementById('status');
const gridEl = document.getElementById('grid');
const searchInput = document.getElementById('searchInput');

// Parse CSV properly, handling quotes if necessary
function parseCSV(csv) {
    const lines = csv.trim().split('\n');
    const result = [];
    // Skip header
    for (let i = 1; i < lines.length; i++) {
        const line = lines[i].trim();
        if (!line) continue;
        
        // Simple split for this specific dataset (assuming "Points,Name")
        // Some names might have commas, but the format seems "Int,String"
        const firstComma = line.indexOf(',');
        if (firstComma === -1) continue;

        const points = parseInt(line.substring(0, firstComma));
        let name = line.substring(firstComma + 1);

        // Remove surrounding quotes if present
        if (name.startsWith('"') && name.endsWith('"')) {
            name = name.slice(1, -1);
        }
        
        // Replace common variations for better matching
        // (Actually, let's keep original for display, normalize for matching)
        result.push({ points, name });
    }
    return result;
}

// Normalize string for better matching (ignore width, case, spaces)
function normalize(str) {
    return str
        .replace(/[\s　]/g, '') // Remove spaces
        .replace(/[！-～]/g, function(s) { // Fullwidth to Halfwidth
            return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
        })
        .toLowerCase();
}

async function init() {
    try {
        // 1. Parse CSV
        processedData = parseCSV(csvRaw);
        statusEl.textContent = `${processedData.length} 枚のカード情報をロード中... (APIから画像情報を取得しています)`;

        // 2. Fetch YGOProDeck DB (Japanese) to map Name -> ID
        // This is a large file (~10MB+ uncompressed), so it might take a moment.
        const response = await fetch('https://db.ygoprodeck.com/api/v7/cardinfo.php?language=ja');
        const apiData = await response.json();

        // 3. Create a Map for fast lookup
        // Normalize API names too
        if (apiData && apiData.data) {
            apiData.data.forEach(card => {
                if (card.name) {
                    cardMap.set(normalize(card.name), card.id);
                }
            });
        }

        statusEl.textContent = `全${processedData.length}枚を表示中`;
        render(processedData);

    } catch (e) {
        console.error(e);
        statusEl.textContent = "エラー: 画像APIの読み込みに失敗しました。画像なしで表示します。";
        render(processedData);
    }
}

function getBadgeColor(points) {
    if (points >= 100) return 'pt-100';
    if (points >= 50) return 'pt-high';
    if (points >= 20) return 'pt-mid';
    return 'pt-low';
}

function render(list) {
    gridEl.innerHTML = '';
    
    // Optimize rendering for large lists (Fragment)
    const fragment = document.createDocumentFragment();

    list.forEach(item => {
        const normalizedName = normalize(item.name);
        const cardId = cardMap.get(normalizedName);
        
        // Image URL or Placeholder
        // YGOProDeck Images: https://images.ygoprodeck.com/images/cards_small/[ID].jpg
        const imgUrl = cardId 
            ? `https://images.ygoprodeck.com/images/cards_small/${cardId}.jpg`
            : null;

        const el = document.createElement('div');
        el.className = 'card-item';
        
        const badgeClass = getBadgeColor(item.points);
        
        // HTML Structure
        // Use loading="lazy" for performance
        let imgHtml = '';
        if (imgUrl) {
            imgHtml = `<img src="${imgUrl}" alt="${item.name}" class="card-img" loading="lazy" onload="this.classList.add('loaded')">`;
        } else {
            // Fallback for no image found
            imgHtml = `<div style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; color:#555; font-size:0.8rem;">No Image</div>`;
        }

        el.innerHTML = `
            <div class="point-badge ${badgeClass}">${item.points}</div>
            <div class="card-img-container">
                ${imgHtml}
            </div>
            <div class="card-info">
                <div class="card-name">${item.name}</div>
            </div>
        `;
        
        // 修正後のコード
        el.onclick = () => {
        // 公式データベースで検索
        window.open(`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=1&keyword=${encodeURIComponent(item.name)}`, '_blank');
};
        el.style.cursor = "pointer";
        el.title = "クリックしてGoogle検索";

        fragment.appendChild(el);
    });

    gridEl.appendChild(fragment);
}

// Search Listener
searchInput.addEventListener('input', (e) => {
    const term = e.target.value.toLowerCase();
    const filtered = processedData.filter(item => {
        return item.name.toLowerCase().includes(term) || 
               item.points.toString().startsWith(term);
    });
    render(filtered);
    statusEl.textContent = `検索結果: ${filtered.length}枚`;
});

// Start
init();

</script>

</body>
</html>
